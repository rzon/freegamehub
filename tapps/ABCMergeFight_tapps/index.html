<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>ABC Merge Fight</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-XXXXXXXXXX', {
            'page_path': window.location.pathname + window.location.search
        });
    </script>
</head>
<body style="margin: 0px; padding: 0px; overflow: hidden;">
    <h1>Welcome to ABC Merge Fight</h1>

    <!-- 邀请按钮 -->
    <button id="inviteButton">Invite Friends</button>

    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        Telegram.WebApp.ready();

        // 获取 URL 参数
        function getQueryParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const regex = /([^&=]+)=([^&]*)/g;
            let m;
            while (m = regex.exec(queryString)) {
                params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
            }
            return params;
        }

        // 处理参数并重定向
        function handleParamsAndRedirect() {
            const params = getQueryParams();
            if (params.start) {
                const utmParams = params.start;
                const targetUrl = `https://www.freegamehub.top/tapps/ABCMergeFight_tapps/?${utmParams}`;
                window.location.href = targetUrl;
            }
        }

        handleParamsAndRedirect();

        // 当用户的 Telegram 应用程序中的主题设置发生变化时，触发该事件
        Telegram.WebApp.onEvent('themeChanged', function() {
            document.documentElement.className = Telegram.WebApp.colorScheme;
        });

        // 调用 showPopup API 的函数
        function showPopup() {
            Telegram.WebApp.showPopup({
                title: 'Invite Friends',
                message: 'Invite your friends to join ABC Merge Fight!',
                buttons: [
                    {id: 'invite', type: 'default', text: 'Invite via Telegram'}
                ]
            }, function(btn) {
                if (btn === 'invite') {
                    const inviteLink = "https://t.me/ABCMergeFight_bot?start=utm_source=share_tg";
                    Telegram.WebApp.openLink(inviteLink);
                }
            });
        }

        // 为邀请按钮添加事件监听器
        document.getElementById('inviteButton').addEventListener('click', showPopup);
    </script>
</body>
</html>
