<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>ABC Merge Fight</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EG9G8JFGHX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-EG9G8JFGHX', {
            'page_path': window.location.pathname + window.location.search
        });
    </script>
</head>
<body style="margin: 0px; padding: 0px; overflow: hidden;">
    <h1>Welcome to ABC Merge Fight</h1>

    <!-- 邀请按钮 -->
    <button id="inviteButton">Invite Friends</button>

    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        Telegram.WebApp.ready();

        // 获取 initDataUnsafe
        const initData = Telegram.WebApp.initDataUnsafe;
        console.log("initData:", initData);

        // 获取 start_param
        const startParam = initData.start_param;
        console.log("start_param:", startParam);

        // 获取并打印当前窗口的 URL
        const currentUrl = window.location.href;
        console.log("当前窗口的 URL:", currentUrl);

        if (startParam) {
            // 解析 start_param 参数
            console.log("Start parameter found:", startParam);
            const regex = /^([A-Z]+)_(.+)$/;
            const match = startParam.match(regex);

            if (match) {
                const utmMedium = match[1];
                const utmSource = match[2];
                console.log(`UTM Medium: ${utmMedium}`);
                console.log(`UTM Source: ${utmSource}`);

                // 拼接新的 URL
                const newUrl = `${currentUrl}&utm_source=${utmSource}&utm_medium=${utmMedium}`;
                console.log("新的 URL:", newUrl);
            } else {
                console.log("start_param 参数格式不匹配");
            }
        } else {
            console.log("没有 start_param 参数");
        }

        // 邀请按钮点击事件
        document.getElementById('inviteButton').addEventListener('click', function() {
            const inviteLink = `https://t.me/share/url?url=https://t.me/ABCMergeFight_bot/game?startapp=KACAEE_sharetg&text=Join+ABC+Merge+Fight+now!`;
            Telegram.WebApp.openTelegramLink(inviteLink);
        });
    </script>
</body>
</html>
