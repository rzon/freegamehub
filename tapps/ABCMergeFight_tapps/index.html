<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>ABC Merge Fight</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EG9G8JFGHX"></script>
    <script>
        // 初始化并获取参数
        Telegram.WebApp.ready()
        const initData = Telegram.WebApp.initDataUnsafe;
        console.log("initData:", initData);

        const startParam = initData.start_param;
        console.log("start_param:", startParam);

        let utmSource = null;
        let utmMedium = null;

        if (startParam) {
            console.log("Start parameter found:", startParam);
            const regex = /^([A-Z]+)_(.+)$/;
            const match = startParam.match(regex);

            if (match) {
                utmMedium = match[1];
                utmSource = match[2];
                console.log(`UTM Medium: ${utmMedium}`);
                console.log(`UTM Source: ${utmSource}`);
            } else {
                console.log("start_param 参数格式不匹配");
            }
        } else {
            console.log("没有 start_param 参数");
        }

        // 设置 Google Analytics 配置
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        console.log("非常nice");
        gtag('config', 'G-EG9G8JFGHX', {
            'campaign_source': utmSource,
            'campaign_medium': utmMedium
        });

    </script>
</head>
<body style="margin: 0px; padding: 0px; overflow: hidden;">
    <h1>Welcome to ABC Merge Fight</h1>

    <!-- 邀请按钮 -->
    <button id="inviteButton">Invite Friends</button>

    <!-- 邀请按钮事件 -->
    <script>
        // 邀请按钮点击事件
        document.getElementById('inviteButton').addEventListener('click', function() {
            const inviteLink = `https://t.me/share/url?url=https://t.me/ABCMergeFight_bot/game?startapp=KACAEE_sharetg&text=Join+ABC+Merge+Fight+now!`;
            Telegram.WebApp.openTelegramLink(inviteLink);
        });
    </script>
</body>
</html>
